# mysql

[mysql配置文件](#mysql配置文件)

## mysql配置文件

### 主要配置文件

1. ​	二进制日志 log-bin

   [MySQL二进制日志总结](https://www.cnblogs.com/kerrycode/p/6610874.html)

2. 数据文件

   1. frm文件 ：存放表结构
   2. myd文件：存放表数据
   3. myi文件：存放表索引

3. 如何配置：

   1. Windows： my.ini文件
   2. Linux：/etc/my.cnf文件

## mysql基本命令

| **操作**                   | **命令**                                                     |
| -------------------------- | ------------------------------------------------------------ |
| mysql启动                  | /etc/init.d/mysqld start (强制关闭：killall mysqld， pkill mysqld， killall -9 mysqld) |
| 关闭数据库                 | /etc/init.d/mysqld stop                                      |
| 确认mysql端口是否开启      | ss -lnt \| greg 3306                                         |
| 查看mysql进程              | ps -ef \| grep mysql \| grep -v grep                         |
| 创建数据库                 | CREATE DATABASE 数据库名；                                   |
| 查看数据库                 | SHOW DATABASES；                                             |
| 指定要操作的数据库         | USE 数据库名；                                               |
| 创建数据表                 | CREATE TABLE 数据表名；                                      |
| 查看数据表                 | SHOW CREATE TABLE 数据表名；                                 |
| 使用DESCRIBE语句查看数据表 | DESCRIBE 数据表名；                                          |
| 为数据表重命名             | ALTER TABLE 数据表名 RENAME 新表名；                         |
| 修改字段名                 | ALTER TABLE 数据表名 CHANGE 旧字段名 新字段名 新数据类型；   |
| 修改字段数据类型           | ALTER TABLE 数据表名 MODIFY 字段名 数据类型；                |
| 添加字段                   | ALTER TABLE 数据表名 ADD 字段名 数据类型；                   |
| 删除字段                   | ALTER TABLE 表名 DROP 字段名；                               |
| 修改字段的排列位置         | ALTER TABLE 数据表名 MODIFY 字段名1 数据类型 FIRST \| AFTER 字段名2 |
| 删除数据表                 | DROP TABLE 数据表名；                                        |



## 外键

### mysql提供了4种外键关联策略

**1、RESTRICT  限制（默认策略）**

要删除tb_user中的记录，或者更新主键字段的值，如果tb_order中有记录与之关联，则不能删除、更新（执行操作时会报错）

**2、CASCADE  级联**

删除tb_user中的记录时，会自动删除tb_order中与之关联的记录；

修改tb_user中id字段的值时，会自动修改tb_order中与之关联的记录的外键字段的值（同步变化）。

**3、NO ACTION  什么也不做**

删除tb_user中的记录，或者修改id字段的值，但tb_order中有记录与之关联，可以删除、更新，tb_order中与之关联的记录不作任何处理（数据不发生变化）。

此种策略需要存储引擎支持，如果存储引擎不支持，会自动换为RESTRICT。

**4、SET NULL  置为NULL**

删除tb_user的记录，或更新主键字段的值，会自动将tb_order中与之关联的记录的外键字段的值置为NULL。

这种方式有一个要求：设计tb_order时，外键user_id不能使用NOT NULL约束。

CASCADE用得最多，其次是RESTRICT，未设置外键关联策略时默认为RESTRICT（为了数据安全）。



## 索引

​		MySQL官方对索引的定义为:索引(Index)是帮 助MySQL高校获取数据的数据结构。可以得到索引的本质:索弓|是数据结构。也可以理解为“排好序的快速查找数据结构”。

​		数据本身之外,数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据,这样就可以在这些数据结构的基础上实现高级查找算法，这种数据结构就是索引。

### 索引分类

1. 单值索引：几个索引包含单个列，一个表可以有多个单列索引（注：`一张表索引最好不要超过5个，优先考虑复合索引`）
2. 唯一索引：索引列的值必须唯一，但是允许有空值
3. 复合索引：即一个索引包含多个列

### 基本语法

创建：

删除：

查看：

### mysql索引结构

#### B+ Tree 原理

​		特点是定位高效、利用率高、自我平衡，特别适用于高基数字段，定位单条或小范围数据非常高效。理论上，使用Btree在亿条数据与100条数据中定位记录的花销相同。

![BTree存储图](E:\programming\myProject\githob\KnowledgeReview\images\BTree存储图.png)

查找过程：

​		如果要查我数据项29，那么首先会把磁盘块1由磁盘加载到内存，此时发生一次IO，在内存中用二分查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短(相比磁盘的I0)可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO， 29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分查找找到29，结束查询，总计三次IO.



树形结构：由根节(root)、分支(branches)、叶(leaves)三级节点组成，其中分支节点可以有多层。

多分支结构：与binary tree不相同的是，btree索引中单root/branch可以有多个子节点(超过2个)。

双向链表：整个叶子节点部分是一个双向链表(后面会描述这个设计的作用)

平衡扩张

除了利用率高、定位高效外，Btree的另一个特点是能够永远保持平衡，这与它的扩张方式有关。(unbalanced和hotspot是两类问题，之前我一直混在一起)，先描述下Btree索引的扩张方式：

（PS：需要研究哈）

[BTree和B+Tree](https://www.jianshu.com/p/ac12d2c83708)



#### hash索引

哈希索引能以 O(1) 时间进行查找，但是失去了有序性：

- 无法用于排序与分组；
- 只支持精确查找，无法用于部分查找和范围查找。

InnoDB 存储引擎有一个特殊的功能叫“自适应哈希索引”，当某个索引值被使用的非常频繁时，会在 B+Tree 索引之上再创建一个哈希索引，这样就让 B+Tree 索引具有哈希索引的一些优点，比如快速的哈希查找。

#### full-text 全局索引

MyISAM 存储引擎支持全文索引，用于查找文本中的关键词，而不是直接比较是否相等。

查找条件使用 MATCH AGAINST，而不是普通的 WHERE。

全文索引使用倒排索引实现，它记录着关键词到其所在文档的映射。

InnoDB 存储引擎在 MySQL 5.6.4 版本中也开始支持全文索引。

#### R-Tree

MyISAM 存储引擎支持空间数据索引（R-Tree），可以用于地理数据存储。空间数据索引会从所有维度来索引数据，可以有效地使用任意维度来进行组合查询。

必须使用 GIS 相关的函数来维护数据。

## 查询性能优化

#### 性能分析

###### Explain 进行分析（待详细写）

​	



